{% extends "base.html" %}
{% block body_block %}

<div class="container">
  <div class="jumbotron">
    <h1>Employee Vacation Portal</h1>
    {% if user.is_authenticated %}
        <h2>Welcome {{ user.username }}!</h2><br>
{% csrf_token %}
<table id="vacation_table" class="display" style="width:100%">
	<thead>
		<tr>
		
		    <th></th>
			<th>Vacation Description</th>    
			<th>DateFrom</th>  
            <th>DateTo</th>
			<th>Status</th>
			<th>Actions</th>

			
		</tr>
	</thead>
	<tbody>
		
	</tbody>
	<tfoot>
	   <tr>
	      <th></th>
	      <th style="width:140px;" data-searchable="true">Description</th>
	      <th style="width:140px;" data-searchable="false">DateFrom</th>
		  <th style="width:140px;" data-searchable="false">DateTo</th>
		   <th style="width:140px;" data-searchable="false">Status</th>
		  <th style="width:140px;" data-searchable="false">Actions</th>
		</tr>  
		   </tfoot>
	
</table>

<div id="modal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update Status</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to update the status?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Yes</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-1.12.4.js" integrity="sha256-Qw82+bXyGq6MydymqBxNPYTaUXXq7c8v3CwiYwLLNXU=" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js" defer></script>
<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src = "http://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js" defer ></script>-->
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous" defer></script>




<script>

	   function format ( d ) {
    // `d` is the original data object for the row
    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
        '<tr>'+
            '<td>Description:</td>'+
            '<td>'+d.Description+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>DateFrom:</td>'+
            '<td>'+d.DateFrom+'</td>'+
        '</tr>'+
        '<tr>'+
            '<td>DateTo:</td>'+
            '<td>'+d.DateTo+'</td>'+
        '</tr>'+
    '</table>';
}



$(function(){

      

	var vacation_table_obj = $("#vacation_table").DataTable({
			ajax: {
				url: "{% url 'listvacations' %}",
				type: "POST",
				data: function(d){
					d.csrfmiddlewaretoken = $("input[name=csrfmiddlewaretoken]").val();
					d.user = "{{user}}"
				}
			},
			
			lengthMenu: [1,5,10,25,50],
			pageLength: 10,
			
			processing: true,
			serverSide:true,
			columns: [
			
			        {
                "className":      'details-control',
                "orderable":      false,
                "data":           null,
                "defaultContent": ''
            },
			
			
				{'data': 'Description', 'name': 'Description', 'sortable': true},
				{'data': 'DateFrom', 'name': 'DateFrom', 'sortable': true},
			    {'data': 'DateTo', 'name': 'DateTo', 'sortable': true},
				{'data': 'Status', 'name': 'Status', 'sortable': true},
				{'data': 'action'}
			],
				
			
			columnDefs: [
			  {  
			     targets: -1,
				 title: 'Actions',
				 render: function(data, type, full, meta){
				   var edit_url = "{% url 'vacation_form' %}?id=" + full.id;
				   
				   return "<a href='"+edit_url+"'>Edit</a> <button id='update' class='update-btn' data-id='"+ full.id +"'><i  class='fa fa-file'></i></button>" ;
				 
				   
				 
				 }
			 }
		 ],
		 
		 
         'rowCallback': function(row, data, index){
       if(data[3]='True'){
        $(row).css('background-color', 'lightgreen');
    }
      else{
        $(row).css('background-color', 'red');
    }
  }
			
			
	
			
			
		});
		
	$("#vacation_table tfoot th[data-searchable=true]").each(function(){
	     var title=$(this).text();
		 $(this).html('<input type="text" placeholder="search '+ title + '"/>');
		});
		
		vacation_table_obj.columns().every(function(){
		var column= this;
		 $('input', this.footer()).on('change', function(){
		     if(column.search() != this.value) {
			    column.search(this.value).draw();
				}
		});
		
		});
		
		    // Add event listener for opening and closing details
    $('#vacation_table tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row( tr );
 
        if ( row.child.isShown() ) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            // Open this row
            row.child( format(row.data()) ).show();
            tr.addClass('shown');
        }
    } );
		
		
		
     $("#update").click(function(){
	   
	   $("#modal").show();
	   $("input[name=vacation_id]").val($(this).attr('data-id'))
	   });
	   
	   
	   
	   

	   
	
		
		
		
	});
 

	

   
   
   
	</script> 
		
		<br><br>
		
<center><button type="button"><a href="/NewVacation">Add new vacation</a></button></center> 
		
		
    {% else %}
        <h2>Welcome to the site!</h2>
    {% endif %}
  </div>
</div>

{% endblock %}
