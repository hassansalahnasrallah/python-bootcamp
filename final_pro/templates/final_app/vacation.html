{% extends 'base.html' %}
{% load static %}
{% block container_block %}
<form class="jumbotron" name="Add_Vacation" action="{% url 'save' %}" method="POST">
	{% csrf_token%}
	<h3>Fill out the vacation details</h3>
	<br>
	<input class="form-control" name="desc" value="{{ vacation.vacation_desc }}" placeholder="Description"  required />
	<br>
	<input class="form-control" type="date" name="date_from" id="date_from" value="{{ vacation.datefrom|date:'Y-m-d' }}" required   />
	<br>
	<input class="form-control" type="date" name="date_to" id="date_to" value="{{ vacation.dateto|date:'Y-m-d' }}"required  /><br>
	<label>Duration:</label>
	<br>
	<input class="form-control" type="text" name="duration" id="duration" readonly/>
	<button type="button" id="Btn_Calculate"> Calculate </button>
	<br>
	<input type="hidden" name="vacation_id" value="{{vacation.id}}"/>
	<br>
	<button type="button" id="save_vacation" class="btn btn-success"> Save </button>
</form>
<script src="http://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="{% static 'js/vacation_validate.js' %}" ></script>

<script>

$(function(){
	$("#Btn_Calculate").click(function(){
	    console.log("done");
		var data= $("#date_from").val();
		var array = data.split('-');
		FirstDate = new Date(array[0],array[1],array[2])
		var data1= $("#date_to").val();
		var array1=data1.split('-');
		SecondDate=new Date(array1[0],array1[1],array1[2]);
		var timedifference= SecondDate.getTime() - FirstDate.getTime();
		console.log(timedifference);
		var nodays= timedifference/(1000*3600*24);
		console.log(nodays);
		$("#duration").val(parseInt(nodays)+" days");
	});

	$("#save_vacation").click(function(){
		
		$.ajax({
			type:"POST",
			url:"{% url 'save' %}",
			data: {
				desc:$('input[name=desc]').val(),
				date_from:$('input[name=date_from]').val(),
				date_to:$('input[name=date_to]').val(),
				vacation_id:$('input[name=vacation_id]').val(),
				csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()
			},
			dataType:'json',
			success: function(response){
				console.log(response)
				if(response.status=='OK'){
					alert("Save Success");
					var vacation_id=response.payload.id
					$("input[name=vacation_id]").val(vacation_id)
				}else if(response.message=='VACATION_NAME_DUPLICATE'){
					alert("Vacation alraedy found");
				}else if (response.message=='MISSING_RQUIRED_PARAMETERS'){
					alert("You have a missing parameter");
				}
			},
			error: function(){
				alert("error in save")
			}
		});
		
	});
	
});
</script>

{% endblock%}