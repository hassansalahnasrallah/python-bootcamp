{% extends 'base.html'%}

<link rel="stylesheet" href="https://formvalidation.io/vendors/formvalidation/css/formValidation.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.14/jquery.datetimepicker.min.css" rel="stylesheet"/>

{% block container %}
<form class="jumbotron" name="Edit_Profile" id="Edit_Profile" action="{% url 'save_profile' %}" method="POST">
		<h2> Edit your Profile</h2>
		{% csrf_token %}
		<label>Job Position</label>
		<select  class="form-control" name="jobposition" id="jobposition" value="{{user_profile.job_position}}">
					<option value="Manager">Manager</option>
					<option value="Assistant Manager">Assistant Manager</option>
					<option value="Excutive">Excutive</option>
					<option value="Director">Director</option>
					<option value="Coordinator">Coordinator</option>
					<option value="Administrator">Administrator</option>
					<option value="Human Resources">Human Resources</option>
				</select>
		<br>
		<label>Date of birth</label>
		<input type="text" name="dateofbirth" id="dateofbirth" class="form-control" value="{{user_profile.date_of_birth|date:'d/m/Y' }}" required/>
		<br>
		<label>Profile Picture</label>
		<input  type="file" name="profilepic" id="profilepic"/>
		<br>
		<input type="button" class="btn btn-primary" id="save_profile" name="save_profile" value="Save"/>
		<input type="hidden" name="user_id" value="{{user.id}}"/>
		
	</form>
</div>
<!--  <img src="{{MEDIA_URL}}{{user_profile.profile_pic}}" /> -->
{% endblock %}



{% block scripts %}
<script src="http://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
<script src="https://momentjs.com/downloads/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.14/jquery.datetimepicker.full.js"></script>
<script>
$(function(){
	
	$("#dateofbirth").datepicker({
		'format': "dd/mm/yyyy",
		    })
		    
 $("#Edit_Profile").validate({
	rules: {
		jobposition: {
			required: true,
		},
		profilepic: {
			required: true,
		},
		dateofbirth: {
			required: true,
		},
	}, 

	messages: {
		jobposition: {
			required: "Job Position is required"
		},
		profilepic: {
			required: "Profile pic is required"
		},
		dateofbirth: {
			required: "Birth Date is required"
		},
		
	},
		

	
	   submitHandler: function(){
		var formData = new FormData();
		
 		formData.append('jobposition', $("input[name=jobposition]").val()); 
 		formData.append('dateofbirth', $("input[name=dateofbirth]").val()); 
 		formData.append('profilepic', $("input[name=profilepic]")[0].files[0]);
		formData.append('csrfmiddlewaretoken', $('input[name=csrfmiddlewaretoken]').val());
 	 	 
		console.log(formData);
		
		$.ajax({
			method: "POST",
			url: "{% url 'save_profile' %}",
			data: formData,
			processData: false,
			contentType: false,
			success: function(response){
				
				if(response.status == 'OK'){
					toastr.success("Save success");
					var vacation_id = response.payload.id;
					$("input[name=vacation_id]").val(vacation_id);

				}else{
					if(response.message == 'FAIL'){
						toastr.success("Fail to save")
					}else if(response.message == "MISSING_REQUIRED_PARAMETERS"){
						toastr.success("You have missing parameters")
					}
					
				}
			},
			error: function(){
				
				toastr.success("Error in save")
			}
		});
	}
 });
	
	$("#save-profile").click(function(){
		$("#Edit_Profile").submit();
	});
})

</script>


{% endblock%}