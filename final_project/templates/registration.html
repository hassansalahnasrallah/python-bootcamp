{%extends 'base.html' %}

{%block title%}Registration{% endblock %}

{% block container_block %}

     	<div id="form_div">
      	 <form id="registration_form" method="POST" enctype="multipart/form-data">
      
       		{%csrf_token%}
       		
       		<div class="row form-group">
			<label class="col-sm-12">User Name:</label>
				<div class="col-sm-12">
					<input name="username" class="form-control" value="{{UserForm.username}}" placeholder="username" required>
				</div>
			</div>
			
			<div class="row form-group">
			<label class="col-sm-12">Email:</label>
				<div class="col-sm-12">
					<input name="email" class="form-control" value="{{UserForm.email}}" placeholder="email" required/>
				</div>
			</div>
			
			<div class="row form-group">
			<label class="col-sm-12">Password:</label>
				<div class="col-sm-12">
					<input  type="password" name="password" class="form-control" value="{{UserForm.password}}" placeholder="password" required>
				</div>
			</div>
      		
      		<div class="row form-group">
			<label class="col-sm-12">First Name:</label>
				<div class="col-sm-12">
					<input name="first_name" class="form-control" value="{{UserForm.first_name}}" placeholder="first name" required>
				</div>
			</div>
			
			<div class="row form-group">
			<label class="col-sm-12">Last Name:</label>
				<div class="col-sm-12">
					<input name="last_name" class="form-control" value="{{UserForm.last_name}}" placeholder="Last name" required>
				</div>
			</div>
			
			
			<div class="row form-group">
			<label class="col-sm-12">Position:</label>
				<div class="col-sm-12">
					<input name="position" class="form-control" value="{{UserProfileInfoForm.position}}" placeholder="position" required>
				</div>
			</div>
			
			<div class="row form-group">
			<label class="col-sm-12">Date of Birth:</label>
				<div class="col-sm-12">
					<input id="date_of_birth" name="date_of_birth" class="form-control" value="{{UserProfileInfoForm.date_of_birth|date:'d/m/Y'}}" placeholder="date of birth" required />
				</div>
			</div>
			
			<div class="row form-group">
			<label class="col-sm-12">Picture:</label>
				<div class="col-sm-12">
					<input id="image_1" type="file" name="profile_img" value="{{UserProfileInfoForm.picture}}" required/>				
				</div>
			</div>
			
      		<p>
      	 	<button type="button" id="register" class="btn btn-success">Register</button> 
            </p>
     	 </form>
     	 </div>    
{% endblock %}



{% block scripts %}
<script>

	$(function(){
		
		$( "#registration_form" ).validate({
			  rules: {
				  username: {
			      required: true,	      
			    },
	
			      email: {
				      required: true,	      
				},
				
				 password: {
				      required: true,	      
				},
				
				first_name: {
				      required: true,	      
				},
				
				last_name: {
				      required: true,	      
				},
				
				position: {
				      required: true,	      
				},
				
				date_of_birth: {
				      required: true,	      
				},
				
				picture: {
				      required: true,	      
				},
				   
		
			  },
			  
			  messages: {
				  username: {
					  required: "User name is required" 
				  },
				  
				  email: {
				      required: "Email is required"	      
				  },
				
				  password: {
				      required: "Password is required",	      
				  },
				
				  first_name: {
				      required: "First name is required"	      
				  },
				
				  last_name: {
				      required: "Last name is required"	      
				  },
				
				  position: {
				      required: "Position name is required"	      
				  },
				
				  date_of_birth: {
				      required: "Date of birth is required"	      
				  },
				
				  picture: {
				      required: "Picture is required"	      
				  },
			  
			  
			  
				  
			  },
		
			  submitHandler: function(){
				  
				  	var formData = new FormData();
				    
				  	formData.append('username', $('input[name=username]').val());
				  	formData.append('email', $('input[name=email]').val());
				  	formData.append('password', $('input[name=password]').val());
				  	formData.append('first_name', $('input[name=first_name]').val());
				  	formData.append('last_name', $('input[name=last_name]').val());
				  	
			    	formData.append('profile_img', $('input[name=profile_img]')[0].files[0]); 
			    	formData.append('date_of_birth', $('input[name=date_of_birth]').val());
			    	formData.append('position', $('input[name=position]').val());
			    	formData.append('csrfmiddlewaretoken', $('input[name=csrfmiddlewaretoken]').val());
				  
				  $.ajax({
						method:"POST",
						url:"{% url 'registration_save' %}",
						data: formData,
				        processData: false,
				        contentType: false,
						success: function(response){
							var response = JSON.parse(response)
							
							console.log(response.payload)
							if(response.status == 'OK'){
								toastr.success('Save success')
								$("#image_1").attr('src', '{{MEDIA_URL}}'+response.payload.image_url)
								//var description_id = response.payload.id;
								//$("input[name=description_id]").val(description_id);
							}else{
								if(response.message == "FAIL"){
									toastr.error('Fail to save')									
								}else if(response.message == "MISSING_REQUIRED_PARAMETERS"){
									alert("You have missing parameters");
								}
							}	
					    }, 
					    error: function(){
					    	toastr.error('Error in save')
						}
					});
			 	
			  }
		
		});
		$("#date_of_birth").datepicker({
			'format':"dd/mm/yyyy",
	    });

		$("#register").click(function(){
			$("#registration_form").submit();
		});
		
	});

</script>

{% endblock %}